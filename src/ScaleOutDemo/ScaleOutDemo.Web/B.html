<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
</head>
<body>

    <h1>ScaleOutDemo - SERVER B</h1>

    <div>
        Open page A.html, B.html and C.html. There pages are using 3 different serers...<br/>
        Then... Click button "create" to "fake" saving a person.<br />
        Regardless of server the message about the new person will reach all clients.
        <br />
        <button id="create">CREATE</button>
    </div>
    <h3>Messages</h3>
    <div data-bind="foreach:vm.messages">
        <div>
            Person created with id <span data-bind="text:person.id"></span> at <span data-bind="text:person.time"></span>.<br/>
            Name <span data-bind="text:person.name"></span> and Age <span data-bind="text:person.age"></span>
            The person was created on server <span data-bind="text:server"></span>
        </div>
    </div>

    <script src="scripts/knockout-3.4.0.js"></script>
    <script src="scripts/XSockets/xsockets.latest.js"></script>
    <script>
        //knockout
        var vm = {
            messages : ko.observableArray([])
        };
        ko.applyBindings(vm);
        // XSockets
        var server = 'ws://localhost:4503';
        var conn = new xsockets.client(server, ['person']);
        var sensor = conn.controller('person');

        sensor.onOpen = function () {

            sensor.on('personcreated', function (d) {
                vm.messages.unshift(d);
            });

            document.querySelector('#create').onclick = function (e) {
                e.stopPropagation();
                sensor.invoke('createperson', { name: 'steve', age: 40 });
            }
        };

        conn.autoReconnect(true);
        conn.open();
    </script>
</body>
</html>
